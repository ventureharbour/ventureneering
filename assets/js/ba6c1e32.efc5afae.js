"use strict";(self.webpackChunkVentureneering=self.webpackChunkVentureneering||[]).push([[108],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var u=r.createContext({}),p=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=p(e.components);return r.createElement(u.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},h=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),h=p(t),m=a,g=h["".concat(u,".").concat(m)]||h[m]||c[m]||o;return t?r.createElement(g,l(l({ref:n},s),{},{components:t})):r.createElement(g,l({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=h;var i={};for(var u in n)hasOwnProperty.call(n,u)&&(i[u]=n[u]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}h.displayName="MDXCreateElement"},909:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return u},metadata:function(){return p},assets:function(){return s},toc:function(){return c},default:function(){return m}});var r=t(7462),a=t(3366),o=(t(7294),t(3905)),l=["components"],i={authors:"paulkennethkent",title:"\ud83d\udc1b GraphQL Object Caching Bug",description:"The reason why your apollo graph may be broken",slug:"caching-bug",tags:["graphql","apollo"]},u=void 0,p={permalink:"/blog/caching-bug",source:"@site/blog/2022-03-28-caching-bug.mdx",title:"\ud83d\udc1b GraphQL Object Caching Bug",description:"The reason why your apollo graph may be broken",date:"2022-03-28T00:00:00.000Z",formattedDate:"March 28, 2022",tags:[{label:"graphql",permalink:"/blog/tags/graphql"},{label:"apollo",permalink:"/blog/tags/apollo"}],readingTime:1.29,truncated:!0,authors:[{name:"Paul \ud83d\udc68\u200d\ud83d\ude80",title:"Engineer @ Venture Harbour",url:"https://github.com/paulkennethkent",imageURL:"https://github.com/paulkennethkent.png",key:"paulkennethkent"}],frontMatter:{authors:"paulkennethkent",title:"\ud83d\udc1b GraphQL Object Caching Bug",description:"The reason why your apollo graph may be broken",slug:"caching-bug",tags:["graphql","apollo"]},nextItem:{title:"\ud83c\udf9b Static Exhaustive Switches in Typescript",permalink:"/blog/exhaustive-switch"}},s={authorsImageUrls:[void 0]},c=[],h={toc:c};function m(e){var n=e.components,t=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TLDR - make sure the nested objects in the request have unique ids")),(0,o.kt)("p",null,"I am a huge fan of GraphQL and all of its typed goodness. On our most recent project we have been using Apollo Client to manage the graph layer, which for the most part has been good but one thing that has caused us headaches is the cache."),(0,o.kt)("p",null,"In this simple example to recreate the issue we are requesting all teams and their respective players. Knowing that some teams could have players with the same name."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"    teams {\n      id\n      name\n      players{\n        id\n        name\n        poistion\n      }\n    }\n\n")),(0,o.kt)("p",null,"Let's say the ids are a simple dot notation of the full team name and the player's full name. I am making a request for all players that match \u201crobinson\u201d."),(0,o.kt)("p",null,"In the grahpql playground I would see the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[\n    {\n        "id": "blackburn.rovers",\n        "name": "blackburn.rovers",\n        "players": {\n            "id": "paul.robsinson",\n            "name": "paul.robinson",\n            "position": "goalkeeper"\n        }\n    },\n    {\n        "id": "birmingham",\n        "name": "birmingham",\n        "players": {\n            "id": "paul.robsinson",\n            "name": "paul.robinson",\n            "position": "defender"\n        }\n    }\n]\n\n')),(0,o.kt)("p",null,"Nice! That is exactly what I want. In the browser I would see Paul Robinson the Goalkeeper playing for Birmingham. What! Ludicrous."),(0,o.kt)("p",null,"After banging my head against the wall for an hour it turns out that it was caching the nested player object based on the ID. Here are a few solutions:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Unique IDs (of course)"),(0,o.kt)("li",{parentName:"ol"},"Ask yourself do you really need that id? Removing the ID from the gql Player object."),(0,o.kt)("li",{parentName:"ol"},"Alias a different field to be the ID.")))}m.isMDXComponent=!0}}]);