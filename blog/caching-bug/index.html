<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Venture Harbour Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Venture Harbour Engineering Atom Feed"><title data-rh="true">ğŸ› GraphQL Object Caching Bug | Venture Harbour Engineering</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ventureharbour.tech/blog/caching-bug"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="ğŸ› GraphQL Object Caching Bug | Venture Harbour Engineering"><meta data-rh="true" name="description" content="The reason why your apollo graph may be broken"><meta data-rh="true" property="og:description" content="The reason why your apollo graph may be broken"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-28T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/paulkennethkent"><meta data-rh="true" property="article:tag" content="graphql,apollo"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://ventureharbour.tech/blog/caching-bug"><link data-rh="true" rel="alternate" href="https://ventureharbour.tech/blog/caching-bug" hreflang="en"><link data-rh="true" rel="alternate" href="https://ventureharbour.tech/blog/caching-bug" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7c6fe152.css">
<link rel="preload" href="/assets/js/runtime~main.654a9f0a.js" as="script">
<link rel="preload" href="/assets/js/main.189881ef.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="VentureHarbour Engineering" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="VentureHarbour Engineering" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/careers/intro">Career Framework</a><a class="navbar__item navbar__link" href="/showcase">Showcase</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/hiring-better">ğŸ¦¹â€â™€ï¸ How to hire better engineers</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/taming-type-inference">ğŸ‘¾Taming Type Inferenece</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/top-5-social-media-regex-for-web-developers-2022">ğŸ•¸ Top 5 social media regex for web developers 2022</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/blog/caching-bug">ğŸ› GraphQL Object Caching Bug</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/exhaustive-switch">ğŸ› Static Exhaustive Switches in Typescript</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">ğŸ› GraphQL Object Caching Bug</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-28T00:00:00.000Z" itemprop="datePublished">March 28, 2022</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/paulkennethkent" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://github.com/paulkennethkent.png" alt="Paul ğŸ‘¨â€ğŸš€"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/paulkennethkent" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Paul ğŸ‘¨â€ğŸš€</span></a></div><small class="avatar__subtitle" itemprop="description">Engineer @ Venture Harbour</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><strong>TLDR - make sure the nested objects in the request have unique ids</strong></p><p>I am a huge fan of GraphQL and all of its typed goodness. On our most recent project we have been using Apollo Client to manage the graph layer, which for the most part has been good but one thing that has caused us headaches is the cache.</p><p>In this simple example to recreate the issue we are requesting all teams and their respective players. Knowing that some teams could have players with the same name.</p><div class="codeBlockContainer_I0IT language-ts theme-code-block"><div class="codeBlockContent_wNvx" style="color:#F8F8F2;background-color:#282A36"><pre tabindex="0" class="prism-code language-ts codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    teams </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      players</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        poistion</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Let&#x27;s say the ids are a simple dot notation of the full team name and the player&#x27;s full name. I am making a request for all players that match â€œrobinsonâ€.</p><p>In the grahpql playground I would see the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#F8F8F2;background-color:#282A36"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;id&quot;: &quot;blackburn.rovers&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;name&quot;: &quot;blackburn.rovers&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;players&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;id&quot;: &quot;paul.robsinson&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;name&quot;: &quot;paul.robinson&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;position&quot;: &quot;goalkeeper&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;id&quot;: &quot;birmingham&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;name&quot;: &quot;birmingham&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;players&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;id&quot;: &quot;paul.robsinson&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;name&quot;: &quot;paul.robinson&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;position&quot;: &quot;defender&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Nice! That is exactly what I want. In the browser I would see Paul Robinson the Goalkeeper playing for Birmingham. What! Ludicrous.</p><p>After banging my head against the wall for an hour it turns out that it was caching the nested player object based on the ID. Here are a few solutions:</p><ol><li>Unique IDs (of course)</li><li>Ask yourself do you really need that id? Removing the ID from the gql Player object.</li><li>Alias a different field to be the ID.</li></ol></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/graphql">graphql</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/apollo">apollo</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/top-5-social-media-regex-for-web-developers-2022"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">ğŸ•¸ Top 5 social media regex for web developers 2022</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/exhaustive-switch"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">ğŸ› Static Exhaustive Switches in Typescript</div></a></div></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.654a9f0a.js"></script>
<script src="/assets/js/main.189881ef.js"></script>
</body>
</html>