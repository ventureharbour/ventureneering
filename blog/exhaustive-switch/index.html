<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Venture Harbour Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Venture Harbour Engineering Atom Feed"><title data-react-helmet="true">üéõ Static Exhaustive Switches in Typescript | Venture Harbour Engineering</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://ventureharbour.tech/blog/exhaustive-switch"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="üéõ Static Exhaustive Switches in Typescript | Venture Harbour Engineering"><meta data-react-helmet="true" name="description" content="Don&#x27;t be afraid of the Typescript compiler - it only wants to be your friend."><meta data-react-helmet="true" property="og:description" content="Don&#x27;t be afraid of the Typescript compiler - it only wants to be your friend."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-03-07T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/sudo-jaa"><meta data-react-helmet="true" property="article:tag" content="Typescript,programming"><link data-react-helmet="true" rel="icon" href="/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ventureharbour.tech/blog/exhaustive-switch"><link data-react-helmet="true" rel="alternate" href="https://ventureharbour.tech/blog/exhaustive-switch" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ventureharbour.tech/blog/exhaustive-switch" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0a3e65d5.css">
<link rel="preload" href="/assets/js/runtime~main.78c07427.js" as="script">
<link rel="preload" href="/assets/js/main.01b0a1c7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="VentureHarbour Engineering" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="VentureHarbour Engineering" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/careers/intro">Career Framework</a><a class="navbar__item navbar__link" href="/showcase">Showcase</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/blog/exhaustive-switch">üéõ Static Exhaustive Switches in Typescript</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/wrestly">ü§º‚Äç‚ôÄÔ∏è Wrestly</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/count-voncount">üßõ‚Äç‚ôÇÔ∏è Von Count</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/hello-world">üëã Hello World</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">üéõ Static Exhaustive Switches in Typescript</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-07T00:00:00.000Z" itemprop="datePublished">March 7, 2022</time> ¬∑ <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/sudo-jaa" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://github.com/sudo-jaa.png" alt="James"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sudo-jaa" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">James</span></a></div><small class="avatar__subtitle" itemprop="description">Engineer @ Venture Harbour</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><strong>It&#x27;s 2022, and we are in the golden age of web development</strong>. But for all the advancements that tools like Typescript have made in making our lives easier,
there are still things that it is missing that are staple features in other languages. Thankfully with a little work we are able to emulate some of these features
and make our lives easier, reduce the number of bugs we introduce, and make all our colleagues think we&#x27;re awesome with our super esoteric programming skillz.</p><p>One of the features I miss dearly from languages like <em>Rust</em> and <em>ReScript</em> is <strong>pattern matching</strong>. And before anybody comes at me: <a href="https://github.com/tc39/proposal-pattern-matching" target="_blank" rel="noopener noreferrer">yes, there is a proposal for
pattern matching in Typescript</a>. And yes, this proposal should make us all very happy.</p><p>What <em>is</em> pattern matching? To quote the almighty <strong><a href="https://doc.rust-lang.org/book/ch06-02-match.html" target="_blank" rel="noopener noreferrer">book</a></strong>:</p><blockquote><p>Think of a match expression as being like a coin-sorting machine: coins slide down a track with variously sized holes along it, and each coin falls through the first hole it encounters that it fits into. In the same way, values go through each pattern in a match, and at the first pattern the value ‚Äúfits,‚Äù the value falls into the associated code block to be used during execution.</p></blockquote><p>Now this sounds a lot like something that already exists in both Typescript and javascript: the <code>switch</code> statement. And for the most part, a <code>switch</code> does act in much the same
way as a fully-featured <code>match</code>, though with some drawbacks. The main one we&#x27;re going to focus on here is that <code>switch</code> cases in Typescript
are <strong>not exhaustive</strong>. This means there is no guarantee that your <code>switch</code> is going to handle all possible values of your <code>switch</code> case.
Incidentally, in a <code>match</code> in a strongly typed language like <em>Rust</em>, this exhaustiveness is <strong>guaranteed</strong> statically by the compiler. You must handle <strong>all possible</strong> cases
before your code will even run.</p><p>This has some advantages. Primarily this aids development in larger teams where multiple engineers are working broadly in the same area.
I could create a <code>match</code> that handles some variant of a union type or enum, and we would never have to worry about a co-worker
adding a new value to the case and forgetting to handle it. Compiler says no. Your co-worker is forced to add the logic they missed. Bugs are avoided. Everyone is happy.</p><p>You don&#x27;t get this advantage with a <code>switch</code>.</p><p>&quot;But James, you stupid human&quot;, you say. &quot;You realise you can use &#x27;default&#x27; in a switch, right?&quot;.</p><p>Absolutely there is an option to use default, but also if you use it as a catch-all for things that you&#x27;re willing to forget, then
you probably deserve the bugs that are about to come swarming your way.
The issue is that <code>default</code> really does just mean <em>default behaviour</em> that is non-specific to the value being passed to your switch. You
should probably not rely on it to handle missing cases in types that have distinctly known possible values at the point of compilation.</p><blockquote><p>NOTE: This does not apply to things like <code>string</code> and <code>number</code> where you really can have a functionally infinite set of values. Cases like this
you should use <code>default</code> in a switch because you literally don&#x27;t have any other choice. Though this is a problem that favours eliminating <a href="https://refactoring.guru/smells/primitive-obsession" target="_blank" rel="noopener noreferrer">primitive obsession</a>
in favour of using stronger types for your data (such as <code>enum</code> and <code>union</code>), we&#x27;ll discuss that another time.</p></blockquote><p>So what can we do about this? How can we ask the Typescript compiler to check this for us at compile-time?</p><p>Enter <strong>NEVER</strong>!</p><p>If you haven&#x27;t come across if before, <code>never</code> is a powerful Typescript type that tells the compiler that the value in question can never occur.
Everything is assignable to <code>never</code>, but <code>never</code> is not assignable to anything. <code>any</code> isn&#x27;t even assignable to <code>never</code>. It is the ultimate
last word in telling the compiler that this value must never occur.</p><p>Things like functions that solely throw errors are inferred to return <code>never</code>, and that&#x27;s how functions that throw can influence
the control flow of a function.</p><p>We can also use <code>never</code> to force a <code>switch</code> case to be exhaustive, by telling it that the <code>default</code> case is <code>never</code>.</p><p>Let&#x27;s produce an example in literally the only context that has any meaning to me anymore: currency from A Song of Ice and Fire:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">enum Coin {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Halfpenny,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Penny,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Halfgroat,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Groat,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Star,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Stag,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Moon,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">function printValue(coin: Coin) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  switch (coin) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Halfpenny:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      console.log(&quot;I am worth 23520 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Penny:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;I am worth 11760 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Halfgroat:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;I am worth 5880 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Groat:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;I am worth 2940 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Star:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;I am worth 1470 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Stag:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;I am worth 210 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Moon:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      console.log(&quot;I am worth 30 Golden Dragons&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>I can stick any of these coins in that I like, and i&#x27;ll get my value in Dragons.</p><p>But wait! I&#x27;ve forgotten a value in my enum. I&#x27;ve forgotten to put in Dragons.
If I go and do that now:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">enum Coin {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Halfpenny,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Penny,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Halfgroat,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Groat,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Star,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Stag,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Moon,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Dragon</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and call the <code>printValue()</code> function, I don&#x27;t get any print out. I&#x27;ve got no default.</p><p>I could add a default case that handles any unaccounted-for values:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function printValue(coin: Coin) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  switch (coin) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Halfpenny:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      console.log(&quot;23520 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Penny:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;11760 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Halfgroat:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;5880 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Groat:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;2940 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Star:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;1470 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Stag:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        console.log(&quot;210 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    case Coin.Moon:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      console.log(&quot;30 of me is worth 1 Golden Dragon&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      console.log(&quot;I don&#x27;t recognise this currency?&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>But my default needs to be generic no matter how many new coins I add. It can&#x27;t ever be a handler for custom logic for new items I add to the enum.</p><p>However, we can use the default case to <strong>assign</strong> the coin to <code>never</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    default:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      const exhaust: never = coin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      throw new Error(exhaust);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And now the moment we try to compile our code with an enum case unaccounted for, we get the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#F8F8F2"><span class="token plain">index.ts:36:13 - error TS2322: Type &#x27;Coin&#x27; is not assignable to type &#x27;never&#x27;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">36       const exhaust: never = coin;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">~~~~~~~</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found 1 error.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The Typescript compiler is now actively working for us to prevent any bugs that might arise from missing branches in this switch. It is
now exhaustive, and no matter how many new items we add to our enum, we are forced by default to handle them, or we&#x27;re not shipping.</p><p>Take <strong>THAT</strong>, dynamic languages!</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/typescript">Typescript</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/programming">programming</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/wrestly"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">ü§º‚Äç‚ôÄÔ∏è Wrestly</div></a></div></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.78c07427.js"></script>
<script src="/assets/js/main.01b0a1c7.js"></script>
</body>
</html>